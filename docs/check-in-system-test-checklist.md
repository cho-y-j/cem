# GPS 기반 출근 체크 시스템 테스트 체크리스트

**작성일**: 2025-11-08
**버전**: 1.0
**개발 환경**: http://localhost:3001/

---

## 📋 사전 준비

### 1. 데이터베이스 준비
- [ ] work_zones 테이블 생성 확인
- [ ] check_ins 테이블 생성 확인
- [ ] webauthn_credentials 테이블 생성 확인
- [ ] 테스트용 작업 구역 최소 1개 등록

### 2. 테스트 계정 준비
- [ ] Admin 계정: admin@test.com / test123
- [ ] EP 계정: ep@test.com / test123
- [ ] Owner 계정: owner@test.com / test123
- [ ] Worker 계정: PIN 1234 (모바일 로그인)

### 3. 서버 실행
- [ ] `pnpm dev` 실행 확인
- [ ] 서버 포트 확인: http://localhost:3001/
- [ ] 콘솔 에러 없음 확인

---

## 🗺️ Part 1: 작업 구역 관리 (Work Zones)

### EP/Admin 계정으로 테스트

**접속**: http://localhost:3001/work-zones

#### 1.1 작업 구역 생성
- [ ] "새 작업 구역" 버튼 클릭
- [ ] 다이얼로그 열림 확인
- [ ] Google Maps 표시 확인
- [ ] 기본 위치: 서울 시청 (37.5665, 126.9780)

#### 1.2 작업 구역 정보 입력
- [ ] 구역 이름: "테스트 현장 A" 입력
- [ ] 설명: "서울 강남 건설 프로젝트" 입력
- [ ] 마커 드래그 테스트 (지도에서 위치 변경)
- [ ] 위도/경도 값 자동 업데이트 확인

#### 1.3 반경 설정
- [ ] 슬라이더로 반경 조정 (10m ~ 1000m)
- [ ] 원(Circle) 크기 변경 확인
- [ ] 단축 버튼 테스트: 50m, 100m, 200m, 500m

#### 1.4 저장 및 조회
- [ ] "생성" 버튼 클릭
- [ ] 성공 토스트 메시지 확인
- [ ] 작업 구역 카드 목록에 추가됨
- [ ] 카드 정보: 이름, 설명, 위도, 경도, 반경 표시

#### 1.5 수정 및 삭제
- [ ] 작업 구역 카드에서 "수정" 버튼 클릭
- [ ] 기존 정보 불러오기 확인
- [ ] 정보 수정 후 저장
- [ ] "삭제" 버튼 클릭 후 confirm 다이얼로그 확인
- [ ] 삭제 후 목록에서 제거됨

---

## 📱 Part 2: Worker 출근 체크

### Worker 계정으로 테스트

**접속**: http://localhost:3001/mobile/login

#### 2.1 모바일 로그인
- [ ] PIN 1234 입력
- [ ] 로그인 성공
- [ ] /mobile/worker 페이지로 리다이렉트

#### 2.2 출근 전 상태
- [ ] "오늘 아직 출근하지 않았습니다" 배너 표시
- [ ] 인디고 배경색 확인
- [ ] "출근하기" 버튼 표시 (CheckCircle 아이콘)

#### 2.3 GPS 권한 요청
- [ ] "출근하기" 버튼 클릭
- [ ] "GPS 위치를 확인하는 중..." 토스트 메시지
- [ ] 브라우저 위치 권한 요청 팝업
- [ ] "허용" 선택

#### 2.4 출근 성공 (구역 내)
**조건**: Worker가 작업 구역 반경 내에 있는 경우
- [ ] GPS 좌표 획득 확인 (콘솔 로그)
- [ ] API 호출: checkIn.create
- [ ] 성공 토스트: "출근이 완료되었습니다! 작업 구역 내에서 출근하셨습니다 (XXXm)"
- [ ] 페이지 새로고침 시 녹색 "출근 완료" 카드 표시
- [ ] 출근 시간 표시 (예: 09:15)
- [ ] "✓ 작업 구역 내 (XXXm)" 표시

#### 2.5 출근 성공 (구역 외)
**조건**: Worker가 작업 구역 반경 밖에 있는 경우
- [ ] 성공 토스트: "출근이 완료되었습니다! 작업 구역 밖에서 출근하셨습니다 (XXXm 떨어짐)"
- [ ] 출근 완료 카드 표시
- [ ] "⚠ 작업 구역 밖 (XXXm)" 표시 (주황색)

#### 2.6 중복 출근 방지
- [ ] 같은 날 다시 "출근하기" 시도
- [ ] 에러 토스트: "이미 오늘 출근하셨습니다. (HH:MM)"
- [ ] 출근 완료 카드 유지

#### 2.7 GPS 실패 케이스
- [ ] 브라우저 위치 권한 거부 시
- [ ] 에러 토스트: "위치 정보를 가져올 수 없습니다. GPS를 활성화해주세요."
- [ ] GPS 타임아웃 (10초 초과) 시 동일 에러

---

## 📊 Part 3: 관리자 출근 현황 대시보드

### Admin/EP/Owner 계정으로 테스트

**접속**: http://localhost:3001/check-in-monitoring

#### 3.1 페이지 로드
- [ ] "출근 현황" 헤더 표시
- [ ] "새로고침" 버튼 표시
- [ ] "엑셀 다운로드" 버튼 표시
- [ ] 날짜 필터: 오늘 날짜 기본 선택
- [ ] 검색창 표시

#### 3.2 통계 카드
- [ ] "총 출근자" 카드: 숫자 + "명" 표시
- [ ] "구역 내 출근" 카드: 녹색, 숫자 + 퍼센트
- [ ] "구역 외 출근" 카드: 주황색, 숫자 + 퍼센트
- [ ] "생체 인증" 카드: 파란색, "향후 WebAuthn 지원 예정"

#### 3.3 시간대별 분포
- [ ] "오전 (00:00 ~ 11:59)" 숫자 표시
- [ ] "오후 (12:00 ~ 23:59)" 숫자 표시
- [ ] 합계가 총 출근자와 일치

#### 3.4 출근 기록 목록
- [ ] Worker 이름 표시 (user.name)
- [ ] 출근 시간 표시 (HH:MM 형식)
- [ ] 작업 구역 이름 표시 (workZone.name)
- [ ] 거리 표시 (XXXm)
- [ ] 구역 내/외 배지 색상 구분:
  - [ ] 녹색: "구역 내" + CheckCircle 아이콘
  - [ ] 주황색: "구역 외" + XCircle 아이콘

#### 3.5 검색 기능
- [ ] 작업자 이름으로 검색 (한글)
- [ ] 작업 구역 이름으로 검색
- [ ] 검색 결과 실시간 필터링
- [ ] 검색어 지우면 전체 목록 표시

#### 3.6 날짜 필터
- [ ] 날짜 선택 input 클릭
- [ ] 다른 날짜 선택
- [ ] 해당 날짜의 출근 기록만 표시
- [ ] 통계 카드도 함께 업데이트

#### 3.7 새로고침
- [ ] "새로고침" 버튼 클릭
- [ ] RefreshCw 아이콘 회전 애니메이션
- [ ] 데이터 재조회 (refetch)
- [ ] 통계 및 목록 업데이트

---

## 📥 Part 4: 엑셀 다운로드

### Admin/EP/Owner 계정으로 테스트

**위치**: /check-in-monitoring 페이지

#### 4.1 전체 다운로드
- [ ] "엑셀 다운로드" 버튼 클릭
- [ ] 성공 토스트: "엑셀 파일이 다운로드되었습니다"
- [ ] 파일명: `출근기록_YYYY-MM-DD.xlsx`
- [ ] 파일 다운로드 확인

#### 4.2 엑셀 파일 내용 확인
**Excel/Google Sheets에서 열기**
- [ ] 시트명: "출근기록"
- [ ] 열 헤더:
  - [ ] 출근일시
  - [ ] 작업자
  - [ ] 이메일
  - [ ] 작업구역
  - [ ] 구역내출근 (O/X)
  - [ ] 거리(m)
  - [ ] 인증방법
  - [ ] 생체인증 (O/X)
  - [ ] 위도
  - [ ] 경도
- [ ] 데이터 정확성:
  - [ ] 날짜/시간 한국어 형식 (YYYY. MM. DD. 오전/오후 HH:MM:SS)
  - [ ] 작업자 이름 정확
  - [ ] 구역 내/외 정확 (O/X)
  - [ ] GPS 좌표 일치

#### 4.3 날짜 필터 적용 다운로드
- [ ] 특정 날짜 선택
- [ ] "엑셀 다운로드" 클릭
- [ ] 선택한 날짜의 데이터만 다운로드됨

---

## 🔐 Part 5: WebAuthn API 구조 (준비 상태)

### 개발자 도구에서 확인

#### 5.1 API 엔드포인트 존재 확인
```javascript
// 브라우저 콘솔에서 실행
await trpc.webauthn.myCredentials.query();
// → [] (빈 배열 반환 확인)
```

#### 5.2 Router 등록 확인
- [ ] `/server/routers.ts`에 `webauthn: webauthnRouter` 확인
- [ ] `/server/webauthn-router.ts` 파일 존재
- [ ] 6개 프로시저 정의 확인:
  - [ ] generateRegistrationChallenge
  - [ ] registerCredential
  - [ ] generateAuthenticationChallenge
  - [ ] verifyAuthentication
  - [ ] myCredentials
  - [ ] deleteCredential

#### 5.3 데이터베이스 테이블
```sql
SELECT * FROM webauthn_credentials LIMIT 1;
-- 테이블 존재 확인 (데이터 없어도 OK)
```

---

## 🧪 Part 6: 통합 테스트 시나리오

### 시나리오 1: 정상 출근 플로우
1. [ ] EP가 작업 구역 등록 (강남역 반경 200m)
2. [ ] Worker가 모바일 로그인
3. [ ] 작업 구역 근처에서 "출근하기" 클릭
4. [ ] GPS 권한 허용
5. [ ] 출근 성공, 구역 내 확인
6. [ ] Admin이 출근 현황에서 확인
7. [ ] 작업자 이름, 시간, 구역 내 배지 확인

### 시나리오 2: 구역 외 출근 경고
1. [ ] Worker가 작업 구역에서 먼 곳에서 출근
2. [ ] 출근은 성공하지만 "구역 밖" 메시지
3. [ ] Admin이 출근 현황에서 주황색 배지 확인
4. [ ] 거리 표시 (예: 1234m)

### 시나리오 3: 중복 출근 방지
1. [ ] Worker가 오전에 출근
2. [ ] 오후에 다시 출근 시도
3. [ ] 에러 메시지: "이미 오늘 출근하셨습니다"
4. [ ] 출근 완료 카드 유지

### 시나리오 4: 엑셀 다운로드 및 분석
1. [ ] 3명의 Worker가 각각 출근 (2명 구역 내, 1명 구역 외)
2. [ ] Admin이 엑셀 다운로드
3. [ ] Excel 열어서 3행 데이터 확인
4. [ ] "구역내출근" 열에서 O 2개, X 1개 확인

### 시나리오 5: 날짜별 조회
1. [ ] 어제 날짜로 출근 기록 조회 (수동 DB 삽입 필요)
2. [ ] 오늘 날짜로 변경
3. [ ] 오늘 출근 기록만 표시
4. [ ] 통계 카드 업데이트

---

## ⚠️ 에러 케이스 테스트

### GPS 관련
- [ ] GPS 비활성화 시 에러 메시지
- [ ] GPS 권한 거부 시 에러 메시지
- [ ] GPS 타임아웃 시 에러 메시지
- [ ] 실내에서 GPS 정확도 낮을 때

### 권한 관련
- [ ] Worker가 /check-in-monitoring 접근 시도 → 403 Forbidden
- [ ] Worker가 엑셀 다운로드 시도 → 403 Forbidden
- [ ] BP가 작업 구역 생성 시도 → 403 Forbidden (EP/Admin만 가능)

### 데이터 없음
- [ ] 작업 구역 0개일 때 출근 → 성공하지만 거리 검증 없음
- [ ] 출근 기록 0개일 때 대시보드 → "아직 출근한 작업자가 없습니다"

---

## 📈 성능 테스트 (선택)

- [ ] 작업 구역 100개 등록 시 지도 렌더링
- [ ] 출근 기록 1000개 조회 시 로딩 속도
- [ ] 엑셀 다운로드 1000개 데이터 처리 시간
- [ ] 동시 출근 10명 처리

---

## ✅ 최종 확인

### 코드 품질
- [ ] TypeScript 컴파일 에러 없음 (`pnpm check`)
- [ ] 콘솔 에러 없음
- [ ] 네트워크 탭에서 API 에러 없음

### UI/UX
- [ ] 모바일 반응형 레이아웃 확인
- [ ] 버튼 클릭 피드백 (active:scale-95)
- [ ] 로딩 스피너 표시
- [ ] 토스트 메시지 적절한 위치

### 데이터 정합성
- [ ] 출근 시간이 정확히 기록됨
- [ ] GPS 좌표가 정확히 저장됨
- [ ] 구역 내/외 판정이 정확함 (Haversine 공식)
- [ ] 통계 숫자가 실제 데이터와 일치

---

## 📝 테스트 결과 기록

**테스트 수행일**: ________________
**테스트 수행자**: ________________
**통과/실패**: ______ / ______

**주요 이슈**:
1.
2.
3.

**추가 개선 사항**:
1.
2.
3.

---

## 🚀 다음 단계

### 단기 (1주일)
- [ ] WebAuthn 실제 구현 (@simplewebauthn 라이브러리)
- [ ] Worker 정보 추가 표시 (소속 회사, 장비)
- [ ] 출근 알림 기능 (푸시 알림)

### 중기 (1개월)
- [ ] 월별/주별 출근 통계 차트
- [ ] 작업 구역별 출근율 분석
- [ ] 늦은 출근/조퇴 자동 감지

### 장기 (3개월)
- [ ] 얼굴 인식 출근 (WebAuthn)
- [ ] 작업 구역 자동 할당 (AI 추천)
- [ ] 출근 패턴 분석 및 리포트
