# 모바일 GPS 추적 시스템 개선 방안 논의

**작성일**: 2025-01-XX  
**상태**: 논의 중

---

## 🔍 현재 문제점

### 1. 이름과 차량번호 표기 문제
- 마커 정보창에 운전자 이름과 차량번호가 제대로 표시되지 않는 경우 발생
- 데이터 매핑 문제 가능성

### 2. 모바일 GPS 추적의 한계
- **화면이 꺼지면 GPS 추적이 중단됨**
  - 브라우저가 백그라운드로 전환되면 JavaScript 실행이 제한됨
  - `setInterval`이 정지되거나 느려짐
  - 현실적으로 사용 불가능한 상황

### 3. 접근성 문제
- 모바일에서 URL 직접 입력이 어려움
- 바탕화면 아이콘이 없어 접근이 불편함

---

## 💡 해결 방안

### 방안 1: 출근/퇴근 체크만 기록하는 방식 (간단)

**장점:**
- 구현이 간단함
- 배터리 소모가 적음
- 사용자가 명시적으로 출근/퇴근을 체크하므로 데이터 신뢰도가 높음

**단점:**
- 실시간 위치 추적 불가
- 이동 경로 분석 불가
- 긴급 상황 대응 어려움

**구현 내용:**
- 출근 시: 현재 위치 1회 기록
- 퇴근 시: 현재 위치 1회 기록
- 작업 중 위치 추적 없음

---

### 방안 2: PWA (Progressive Web App) 구현 (권장)

**장점:**
- 바탕화면 아이콘 추가 가능
- 앱처럼 사용 가능
- Service Worker를 통한 백그라운드 실행 가능 (제한적)
- 오프라인 지원 가능

**단점:**
- Service Worker의 백그라운드 GPS 추적은 제한적
  - iOS Safari: 백그라운드 GPS 추적 불가
  - Android Chrome: 제한적으로 가능하지만 배터리 소모 큼
  - 브라우저 정책에 따라 다름

**구현 내용:**
1. **PWA Manifest 추가**
   - `manifest.json` 생성
   - 아이콘, 이름, 시작 URL 설정
   - "홈 화면에 추가" 기능 활성화

2. **Service Worker 등록**
   - 백그라운드에서 위치 추적 시도
   - **주의**: 완전한 백그라운드 GPS는 네이티브 앱이 아니면 불가능

3. **사용자 안내**
   - "홈 화면에 추가" 방법 안내
   - 배터리 최적화 설정 안내

---

### 방안 3: 하이브리드 접근 (권장)

**구현:**
1. **출근/퇴근 체크 + 선택적 GPS 추적**
   - 출근 시: 위치 1회 기록 (필수)
   - 퇴근 시: 위치 1회 기록 (필수)
   - 작업 중: 사용자가 선택적으로 GPS 추적 활성화
     - 화면이 켜져 있을 때만 작동
     - 배터리 절약 모드 옵션 제공

2. **PWA로 바탕화면 아이콘 추가**
   - 접근성 향상
   - 앱처럼 사용 가능

3. **실시간 추적은 선택 사항**
   - 관리자가 필요시에만 활성화
   - 작업자가 수동으로 활성화/비활성화 가능

**장점:**
- 현실적이고 실용적
- 배터리 소모 최소화
- 사용자 선택권 제공
- 접근성 향상

---

## 🛠️ 구현 우선순위

### Phase 1: 이름과 차량번호 표기 문제 수정 (즉시)
- 데이터 매핑 확인 및 수정
- 마커 정보창 표시 개선

### Phase 2: PWA 구현 (1-2일)
- `manifest.json` 생성
- Service Worker 등록
- 아이콘 추가
- "홈 화면에 추가" 안내 추가

### Phase 3: GPS 추적 방식 변경 (1일)
- 출근/퇴근 시 위치 기록
- 작업 중 GPS 추적을 선택 사항으로 변경
- 사용자 설정 추가

---

## 📱 PWA 구현 상세

### 1. Manifest.json
```json
{
  "name": "건설장비 관리 시스템",
  "short_name": "CEM",
  "description": "건설장비 및 인력 관리 시스템",
  "start_url": "/mobile",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#3b82f6",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

### 2. Service Worker (제한적)
- 백그라운드 GPS 추적은 브라우저 정책상 제한적
- 오프라인 캐싱, 푸시 알림 등에 활용

### 3. 사용자 안내
- "홈 화면에 추가" 방법 안내
- iOS Safari: 공유 버튼 → 홈 화면에 추가
- Android Chrome: 메뉴 → 홈 화면에 추가

---

## 🤔 결정 사항

1. **GPS 추적 방식**
   - [ ] 방안 1: 출근/퇴근만 체크
   - [ ] 방안 2: PWA + 백그라운드 추적 시도
   - [ ] 방안 3: 하이브리드 (출근/퇴근 + 선택적 GPS)

2. **PWA 구현**
   - [ ] Manifest 추가
   - [ ] Service Worker 등록
   - [ ] 아이콘 생성
   - [ ] 사용자 안내 추가

3. **사용자 경험**
   - [ ] GPS 추적 활성화/비활성화 토글
   - [ ] 배터리 절약 모드 옵션
   - [ ] 위치 추적 상태 표시

---

## 📝 참고사항

- **웹 브라우저의 한계**: 완전한 백그라운드 GPS 추적은 네이티브 앱이 아니면 불가능
- **배터리 소모**: 지속적인 GPS 추적은 배터리를 많이 소모함
- **사용자 경험**: 현실적이고 실용적인 솔루션이 중요함

